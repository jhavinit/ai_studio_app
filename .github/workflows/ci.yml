# name: CI Pipeline

# on:
#   push:
#     branches: [ main, develop ]
#   pull_request:
#     branches: [ main, develop ]

# jobs:
#   lint-and-test:
#     runs-on: ubuntu-latest
    
#     strategy:
#       matrix:
#         node-version: [18.x, 20.x]
    
#     steps:
#       - name: Checkout code
#         uses: actions/checkout@v3
      
#       - name: Setup Node.js ${{ matrix.node-version }}
#         uses: actions/setup-node@v3
#         with:
#           node-version: ${{ matrix.node-version }}
#           cache: 'npm'
      
#       # Frontend
#       - name: Install frontend dependencies
#         run: npm ci
      
#       - name: Lint frontend
#         run: npm run lint
      
#       - name: Run frontend tests
#         run: npm test -- --coverage --watchAll=false
      
#       - name: Upload frontend coverage
#         uses: actions/upload-artifact@v3
#         with:
#           name: frontend-coverage-${{ matrix.node-version }}
#           path: coverage/
      
#       # Backend
#       - name: Install backend dependencies
#         working-directory: ./backend
#         run: npm ci
      
#       - name: Lint backend
#         working-directory: ./backend
#         run: npm run lint
      
#       - name: Run backend tests
#         working-directory: ./backend
#         run: npm test -- --coverage --watchAll=false
#         env:
#           NODE_ENV: test
#           JWT_SECRET: test-secret-key-for-ci
      
#       - name: Upload backend coverage
#         uses: actions/upload-artifact@v3
#         with:
#           name: backend-coverage-${{ matrix.node-version }}
#           path: backend/coverage/
      
#       # Build checks
#       - name: Build frontend
#         run: npm run build
      
#       - name: Build backend
#         working-directory: ./backend
#         run: npm run build
  
#   e2e-tests:
#     runs-on: ubuntu-latest
#     needs: lint-and-test
    
#     steps:
#       - name: Checkout code
#         uses: actions/checkout@v3
      
#       - name: Setup Node.js
#         uses: actions/setup-node@v3
#         with:
#           node-version: 18.x
#           cache: 'npm'
      
#       - name: Install dependencies
#         run: |
#           npm ci
#           cd backend && npm ci && cd ..
      
#       - name: Install Playwright browsers
#         run: npx playwright install --with-deps
      
#       - name: Start backend server
#         working-directory: ./backend
#         run: |
#           npm run dev &
#           sleep 5
#         env:
#           NODE_ENV: test
#           JWT_SECRET: test-secret-key-for-ci
#           PORT: 3001
      
#       - name: Start frontend server
#         run: |
#           npm run dev &
#           sleep 5
      
#       - name: Run E2E tests
#         run: npm run test:e2e
      
#       - name: Upload E2E test results
#         if: always()
#         uses: actions/upload-artifact@v3
#         with:
#           name: e2e-test-results
#           path: test-results/
      
#       - name: Upload E2E screenshots
#         if: failure()
#         uses: actions/upload-artifact@v3
#         with:
#           name: e2e-screenshots
#           path: test-results/screenshots/
  
#   coverage-report:
#     runs-on: ubuntu-latest
#     needs: lint-and-test
    
#     steps:
#       - name: Checkout code
#         uses: actions/checkout@v3
      
#       - name: Download frontend coverage
#         uses: actions/download-artifact@v3
#         with:
#           name: frontend-coverage-18.x
#           path: frontend-coverage/
      
#       - name: Download backend coverage
#         uses: actions/download-artifact@v3
#         with:
#           name: backend-coverage-18.x
#           path: backend-coverage/
      
#       - name: Display coverage summary
#         run: |
#           echo "=== Frontend Coverage ==="
#           cat frontend-coverage/coverage-summary.json || echo "No frontend coverage found"
#           echo ""
#           echo "=== Backend Coverage ==="
#           cat backend-coverage/coverage-summary.json || echo "No backend coverage found"
